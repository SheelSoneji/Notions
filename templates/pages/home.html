{% extends 'base.html' %} {% block headtitle %} testing {% endblock headtitle %}
{% block content %}
<div class="row text-center">
  <div class="col">
    <h1>Welcome to Notions</h1>
  </div>
</div>

<div class="row" id="notions">loading...</div>
<script>
  // this basically, queries /notions and expects a json response which is then printed in the log of the home.html
  const notionsElement = document.getElementById("notions");

  const xhr = new XMLHttpRequest();
  const method = "GET";
  const url = "/notions";
  const responseType = "json";

  function handleDidLike(notion_id, notion_like_count) {
    console.log(notion_id, notion_like_count);
    return;
  }
  function LikeBtn(notion) {
    return (
      "<button class='btn btn-primary btn-sm' onclick= handleDidLike(" +
      notion.id +
      "," +
      notion.likes +
      ")>" +
      notion.likes +
      " Like</button>"
    );
  }

  function formatNotionElement(notion) {
    var fortmattedNotion =
      "<div class= 'col-12 col-md-10 mx-auto border rounded py-3 mb-4' id= 'notion-" +
      notion.id +
      "'<p>" +
      notion.content +
      "</p><div class= 'btn-group'>" +
      LikeBtn(notion) +
      "</div></div>";
    return fortmattedNotion;
  }

  xhr.responseType = responseType;
  xhr.open(method, url);

  xhr.onload = function() {
    const serverResponse = xhr.response;
    var listedItems = serverResponse.response;
    var finalNotionsStr = "";
    var i = 0;
    for (i = 0; i < listedItems.length; i++) {
      var notionObj = listedItems[i];
      var currentItem = formatNotionElement(notionObj);
      finalNotionsStr = finalNotionsStr + currentItem;
    }
    notionsElement.innerHTML = finalNotionsStr;
  };
  xhr.send();
</script>
{% endblock content %}
